@version: 3.0
#Default configuration file for syslog-ng.
#
# For a description of syslog-ng configuration file directives, please read
# the syslog-ng Administrator's guide at:
#
# http://www.balabit.com/dl/html/syslog-ng-admin-guide_en.html/bk01-toc.html
#

options {
create_dirs(yes);
dir_owner("admin");
dir_group("admin");
dir_perm(0755);
owner("admin");
group("admin");
perm(0644);
};

######
# sources
source s_local {
# message generated by Syslog-NG
internal();
# standard Linux log source (this is the default place for the syslog()
# function to send logs to)
unix-stream("/dev/log");
# messages from the kernel
file("/proc/kmsg" program_override("kernel"));






};


######
# destinations
destination d_messages { file("/var/log/messages"); };


log {
source(s_local);
destination(d_messages);
};

source net { udp(ip(0.0.0.0) port(514)); }; 
filter f_haproxy_access { facility(local0) and (level(info) or level(err)); };
filter f_haproxy_error { facility(local0) and level(err); };
filter f_haproxy_info { facility(local0) and (level(notice) or level(warning) or level(alert)); };
destination haproxy_access { file("/home/web_log/haproxy/access/$YEAR$MONTH/$DAY/access.$YEAR$MONTH$DAY$HOUR.log"); };
destination haproxy_error { file("/home/web_log/haproxy/error/$YEAR$MONTH/$DAY/error.$YEAR$MONTH$DAY$HOUR.log"); };
destination haproxy_info { file("/home/web_log/haproxy/haproxy.log"); };
log { source(net); filter(f_haproxy_access); destination(haproxy_access); };
log { source(net); filter(f_haproxy_error); destination(haproxy_error); };
log { source(net); filter(f_haproxy_info); destination(haproxy_info); };

#FIXME, set ip to idc log storage server ip
destination idccenter { udp("192.168.219.110" port(514)); };
log { source(net); filter(f_haproxy_access); destination(idccenter); }; #DO NOT SET THIS ON IDC LOG STORAGE SERVER

